@using WorkflowLib.Examples.EmployeesMvc.Core.Models.Configurations
@using WorkflowLib.Examples.EmployeesMvc.Core.Models.HumanResources
@model IEnumerable<Vacation>
@inject AppSettings _appSettings
@{
    ViewData["Title"] = "Vacations";
}

@try
{
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.0/css/jquery.dataTables.min.css" />

    var filterOptionsSettings = _appSettings.StringSettings.FilterOptionsSettings;
    var jobTitles = System.Enum.GetValues(typeof(JobTitle));
    var departments = System.Enum.GetValues(typeof(Department));

    var languageName = string.Empty;
    if (!Context.Request.Cookies.TryGetValue("employeesmvc-lang", out languageName))
    {
        languageName = "English";
    }

    ViewData["Title"] = _appSettings.Translate(languageName, "Vacations");

    <div class="text-center">
        <h1 class="display-4">@_appSettings.Translate(languageName, "Vacations")</h1>
        @if (TempData["ErrorMessage"] != null)
        {
            <p class="text-danger">Error message: @TempData["ErrorMessage"]</p>
        }
    </div>

    <div>
        <button class="btn btn-dark dropdown" data-bs-toggle="collapse" data-bs-target="#divVacationFilters">@_appSettings.Translate(languageName, "VacationFilters")</button>
        <a class="btn btn-primary" role="button" asp-controller="Home" asp-action="NewVacation">@_appSettings.Translate(languageName, "NewVacation")</a>

        <div class="collapse indent" id="divVacationFilters">
            <div class="text-center">
                <form method="post" asp-controller="Home" asp-action="FilterVacations" role="post">
                    <div class="form-group col-md-4">
                        <label for="fullName">@_appSettings.Translate(languageName, "FullName")</label>
                        <input type="text" class="form-control" id="fullName" name="fullName" placeholder="@_appSettings.Translate(languageName, "FullName.Enter")">
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label for="minAge">@_appSettings.Translate(languageName, "MinimumAge")</label>
                            <input type="text" class="form-control" id="minAge" name="minAge" placeholder="@_appSettings.Translate(languageName, "MinimumAge.Enter")"
                                oninput="this.value = this.value.replace(/[^0-9]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');">
                        </div>
                        <div class="form-group col-md-4">
                            <label for="maxAge">@_appSettings.Translate(languageName, "MaximumAge")</label>
                            <input type="text" class="form-control" id="maxAge" name="maxAge" placeholder="@_appSettings.Translate(languageName, "MaximumAge.Enter")"
                                oninput="this.value = this.value.replace(/[^0-9]/g, ''); this.value = this.value.replace(/(\..*)\./g, '$1');">
                        </div>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="gender">@_appSettings.Translate(languageName, "Gender")</label>
                        <select class="form-control" id="gender" name="gender">
                            <option></option>
                            <option value="Male">@_appSettings.Translate(languageName, "Gender.Male")</option>
                            <option value="Female">@_appSettings.Translate(languageName, "Gender.Female")</option>
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="jobTitle">@_appSettings.Translate(languageName, "JobTitle")</label>
                        <select class="form-control" id="jobTitle" name="jobTitle">
                            <option></option>
                            @foreach (var obj in jobTitles) 
                            {
                                <option value="@obj">@_appSettings.Translate(languageName, $"JobTitle.{obj}")</option>
                            }
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="department">@_appSettings.Translate(languageName, "Department")</label>
                        <select class="form-control" id="department" name="department">
                            <option></option>
                            @foreach (var obj in departments) 
                            {
                                <option value="@obj">@_appSettings.Translate(languageName, $"Department.{obj}")</option>
                            }
                        </select>
                    </div>

                    <div class="form-group col-md-4">
                        <label for="currentFullName">@_appSettings.Translate(languageName, "FullName.CurrentEmployee")</label>
                        <input type="text" class="form-control" id="currentFullName" name="currentFullName" placeholder="@_appSettings.Translate(languageName, "FullName.Enter")">
                    </div>

                    <div class="form-group col-md-4">
                        <label for="filterOptions">@_appSettings.Translate(languageName, "FilterOptions")</label>
                        <select class="form-control" id="filterOptions" name="filterOptions">
                            <option>@filterOptionsSettings.FindFilterOptionsShowAllFilteredVacations</option>
                            <option>@filterOptionsSettings.FindFilterOptionsShowIntersections</option>
                            <option>@filterOptionsSettings.FindFilterOptionsExcludeIntersections</option>
                        </select>
                    </div>

                    <div class="form-group col-md-4">
                        <br>
                        <input type="submit" value="@_appSettings.Translate(languageName, "Find")" class="btn btn-primary col-md-12" />
                    </div>
                    
                </form>
            </div>

            <label><b>@_appSettings.Translate(languageName, "Filters"):</b> @TempData["filterInfoVacations"]</label>
            <br>
            <label><b>@_appSettings.Translate(languageName, "CurrentEmployee"):</b> @TempData["employeeInfoVacations"]</label>
            <br>
            <label><b>@_appSettings.Translate(languageName, "FilterOptions"):</b> @TempData["filterOptionsVacations"]</label>
        </div>
    </div>

    @if (Model == null)
    {
        <p class="text-danger">@_appSettings.Translate(languageName, "Error.DataNotGeneratedYet")</p>
    }
    else
    {
        <br>
        <table name="tblVacations" id="tblVacations" class="table table-bordered table-striped" style="width: 100%">
            <thead>
                <tr>
                    <th>@_appSettings.Translate(languageName, "FullName")</th>
                    <th>@_appSettings.Translate(languageName, "Gender")</th>
                    <th>@_appSettings.Translate(languageName, "JobTitle")</th>
                    <th>@_appSettings.Translate(languageName, "Department")</th>
                    <th>@_appSettings.Translate(languageName, "Age")</th>
                    <th>@_appSettings.Translate(languageName, "BeginDate")</th>
                    <th>@_appSettings.Translate(languageName, "EndDate")</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var obj in Model)
                {
                    var age = System.DateTime.Now.Year - obj.Employee.BirthDate.Year;
                    if (obj.Employee.BirthDate.Month > System.DateTime.Now.Month && obj.Employee.BirthDate.Day > System.DateTime.Now.Day)
                    {
                        age -= 1;
                    }
                    <tr>
                        <td>@obj.Employee.FullName</td>
                        <td>@_appSettings.Translate(languageName, $"Gender.{obj.Employee.Gender}")</td>
                        <td>@_appSettings.Translate(languageName, $"JobTitle.{obj.Employee.JobTitle}")</td>
                        <td>@_appSettings.Translate(languageName, $"Department.{obj.Employee.Department}")</td>
                        <td>@age</td>
                        <td>@obj.BeginDate.ToString("dd.MM.yyyy")</td>
                        <td>@obj.EndDate.ToString("dd.MM.yyyy")</td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//cdn.datatables.net/1.11.0/js/jquery.dataTables.min.js"></script>
    <script language="JavaScript" type="text/javascript">
        $.noConflict();
        jQuery( document ).ready(function( $ ) {
            $(document).ready(function() {
                var table = $('#tblVacations').DataTable({
                    language: {
                        url: '//cdn.datatables.net/plug-ins/2.0.8/i18n/en-GB.json',
                    }
                });
            });
        });
    </script>
}
catch (System.Exception ex)
{
    <div class="text-center">
        <p class="text-danger">Error: @ex.Message</p>
    </div>
}
